/*! simple-map-d3 - v0.1.2 - 2013-08-09
 * http://code.minnpost.com/simple-map-d3/
 * Copyright (c) 2013 Alan Palazzolo; Licensed MIT
 */

function SimpleMapD3(a){var b={},c={"stroke-width":1,stroke:"#898989",fill:"#BDBDBD",colorOn:!1,colorSet:["#F7FCF5","#E5F5E0","#C7E9C0","#A1D99B","#74C476","#41AB5D","#238B45","#005A32"],tooltipOn:!0,tooltipContent:function(a){var b="";for(var c in a.properties)a.properties.hasOwnProperty(c)&&(b+=c+": "+a.properties[c]+"<br />");return b},projection:"albersUsa",styles:{}};return b.constructor=function(a){var d=c;for(var e in a)a.hasOwnProperty(e)&&(d[e]=a[e]);return b.options=d,b.options.data===Object(b.options.data)?(b.data=b.options.data,b.loadData(b.data)):"[object String]"==toString.call(b.options.datasource)&&b.getData(),b},b.getData=function(){return d3.json(b.options.datasource,function(a){b.data=a,b.loadData()}),b},b.loadData=function(a){return void 0===b.data&&(b.data=a),b.topo().canvas().projection().render().fit(),b},b.topo=function(){var a,c;if("topology"===b.data.type.toLowerCase()&&"undefined"!=typeof topojson){for(a in b.data.objects)if(b.data.objects.hasOwnProperty(a)){c=b.data.objects[a];break}b.data=topojson.feature(b.data,b.data.objects[a])}return b},b.canvas=function(){return b.container=d3.select(b.options.container),b.width=parseFloat(b.container.style("width")),b.height=parseFloat(b.container.style("height")),b.canvas=b.container.append("svg").attr("width",b.width).attr("height",b.height),b.group=b.canvas.append("g"),b.options.tooltipOn===!0&&(b.container.classed("simple-map-d3-tooltip-container",!0),b.container.append("div").classed("simple-map-d3-tooltip",!0)),b},b.projection=function(){var a=b.options.projection;return("undefined"==typeof a||"function"!=typeof d3.geo[a])&&(a="albersUsa"),b.centroid=d3.geo.centroid(b.data),b.projection=d3.geo[a]().scale(1e3).translate([b.width/2,b.height/2]),"function"==typeof b.projection.center&&b.projection.center(b.centroid),"undefined"!=typeof b.options.rotation&&b.options.rotation.length>0&&"function"==typeof b.projection.rotate&&b.projection.rotate(b.options.rotation),b.projPath=d3.geo.path().projection(b.projection),b},b.fit=function(){var a=b.bounds=b.projPath.bounds(b.data);return b.group.attr("transform","translate("+b.projection.translate()+")"+"scale("+.95/Math.max((a[1][0]-a[0][0])/b.width,(a[1][1]-a[0][1])/b.height)+")"+"translate("+-(a[1][0]+a[0][0])/2+","+-(a[1][1]+a[0][1])/2+")"),b},b.makeColorRange=function(){var a=d3.min(b.data.features,function(a){return a.properties[b.options.colorProperty]}),c=d3.max(b.data.features,function(a){return a.properties[b.options.colorProperty]});return b.options.colorStep=b.options.colorStep||(c-a)/b.options.colorSet.length/2,b.colorRange=d3.scale.linear().domain(d3.range(a,c,b.options.colorStep)).range(b.options.colorSet).clamp(!0),b},b.attributeFill=function(a){return b.options.colorOn===!1?b.options.fill:(b.ColorRange||b.makeColorRange(),b.colorRange(a.properties[b.options.colorProperty]))},b.render=function(){return b.group.selectAll("path").data(b.data.features).enter().append("path").attr("d",b.projPath).attr("class","smd-path").style(b.options.styles).attr("fill",function(a){return b.attributeFill(a)}).on("mouseover",function(a){b.options.tooltipOn===!0&&b.container.select(".simple-map-d3-tooltip").style("display","block").html(b.options.tooltipContent(a))}).on("mouseout",function(){b.options.tooltipOn===!0&&b.container.select(".simple-map-d3-tooltip").style("display","none")}),b},b.constructor(a),b}